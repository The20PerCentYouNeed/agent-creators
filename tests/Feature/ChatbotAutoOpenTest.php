<?php

test('chatbot should auto-open on first visit in a new session', function () {
    $response = $this->followingRedirects()->get('/');

    $response->assertStatus(200);
    $response->assertSee('data-should-auto-open="true"', false);
    expect(session('chatbot_auto_opened'))->toBeTrue();
});

test('chatbot should not auto-open on subsequent visits in the same session', function () {
    session()->put('chatbot_auto_opened', true);

    $response = $this->get('/');

    $response->assertStatus(200);
    $response->assertSee('data-should-auto-open="false"', false);
    expect(session()->has('should_auto_open_chatbot'))->toBeFalse();
});

test('flash data should only exist for one request', function () {
    $firstResponse = $this->get('/');
    expect(session('should_auto_open_chatbot'))->toBeTrue();

    $secondResponse = $this->get('/');
    expect(session('should_auto_open_chatbot'))->toBeNull();
});
